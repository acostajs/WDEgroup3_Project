<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('./partials/head', { title: title }) %>
    <style>
        /* Basic styling for the schedule view */
        .schedule-day {
            border: 1px solid #eee;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f9f9f9;
        }
        .schedule-day h4 {
            margin-top: 0;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            font-size: 1.1em;
        }
        .schedule-shift {
            border: 1px solid #ddd;
            background-color: #fff;
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 4px;
        }
        .shift-time { font-weight: bold; }
        .shift-position { color: #555; }
        .shift-employee { font-style: italic; }
        .unassigned { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <%- include('./partials/navbar') %>
    <%- include('./partials/flash', { successFlash: successFlash, errorFlash: errorFlash }) %>

    <div class="content-wrapper">
        <h2><%= title %></h2>

        <% if (scheduleData && scheduleData.size > 0) { %>
            <%# Iterate through the Map (shifts grouped by date string) %>
            <% scheduleData.forEach((shiftsOnDay, dateStr) => { %>
                <%# Format date for display (e.g., "Tue, May 01, 2025") %>
                <%
                    const displayDate = new Date(dateStr + 'T00:00:00Z'); // Parse date string as UTC
                    const dateFormatter = new Intl.DateTimeFormat('en-US', {
                        weekday: 'short', year: 'numeric', month: 'short', day: '2-digit', timeZone: 'UTC'
                    });
                    const formattedDate = dateFormatter.format(displayDate);
                %>
                <div class="schedule-day">
                    <h4><%= formattedDate %></h4>

                    <% if (shiftsOnDay && shiftsOnDay.length > 0) { %>
                        <% shiftsOnDay.forEach(shift => { %>
                            <div class="schedule-shift">
                                <span class="shift-time"><%= shift.start_time %> - <%= shift.end_time %></span> |
                                <span class="shift-position"><%= shift.required_position %></span>:
                                <span class="shift-employee">
                                    <% if (shift.assigned_employee && shift.assigned_employee.name) { %>
                                        <%= shift.assigned_employee.name %>
                                         <% } else { %>
                                        <span class="unassigned">Unassigned</span>
                                    <% } %>
                                </span>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <p>No shifts scheduled for this day.</p> <%# Should not happen if date exists in map %>
                    <% } %>
                </div>
            <% }); %>
        <% } else { %>
            <p>No schedule data found for <%= viewMonthStr %>. Please generate the schedule first.</p>
        <% } %>

        <hr style="margin-top: 20px;">
        <p><a href="/">Back to Home</a></p>
        <p><a href="/admin/employees">Back to Employee Management</a></p> {# Link back to admin #}

    </div> {# End content-wrapper #}

</body>
</html>